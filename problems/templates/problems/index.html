{% extends 'base.html' %}

{% block title %}Problems | PyClimb{% endblock %}

{% block extra_styles %}
.page-content {
  max-width: 1280px;
}

header.page-header {
  padding: 24px 0 12px;
  text-align: center;
}
header.page-header h1 {
  margin: 0 0 8px;
  font-size: clamp(2.2rem, 4vw, 3.5rem);
  letter-spacing: 0.02em;
}
header.page-header p.subtitle {
  margin: 0;
  color: var(--muted);
  font-size: 1.05rem;
}
.filters {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
  justify-content: center;
  margin: 24px 0;
}
.filters select {
  padding: 8px 16px;
  font-family: inherit;
  font-size: 0.95rem;
  border: 2px solid var(--pixel-border);
  border-radius: 0;
  background: #fff8e8;
  box-shadow: 2px 2px 0 #d8a46f;
  cursor: pointer;
}
.filters select:focus {
  border-color: var(--pixel-border);
}
.filter-clear {
  padding: 8px 16px;
  font-family: inherit;
  font-size: 0.95rem;
  color: var(--muted);
  background: #fff8e8;
  border: 2px solid var(--pixel-border);
  border-radius: 0;
  box-shadow: 2px 2px 0 #d8a46f;
  cursor: pointer;
  text-decoration: none;
}
.filter-clear:hover {
  border-color: var(--pixel-border);
  color: #1e1a14;
  background: #ffd09a;
}
ul.problem-list {
  list-style: none;
  margin: 32px 0 0;
  padding: 0;
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 16px;
  align-items: stretch;
}
ul.problem-list > li {
  display: flex;
  min-height: 292px;
}
a.problem-card {
  display: flex;
  flex-direction: column;
  height: 100%;
  width: 100%;
  padding: 18px 18px 16px;
  background: linear-gradient(180deg, #fffaf0 0%, #fff3dc 100%);
  border: 2px solid var(--pixel-border);
  border-radius: 0;
  text-decoration: none;
  color: inherit;
  box-shadow: 4px 4px 0 #d39a6a;
  transition: transform 120ms ease, box-shadow 120ms ease;
  position: relative;
}
a.problem-card.easy {
  box-shadow: 4px 4px 0 #8dbf7a;
}
a.problem-card.medium {
  box-shadow: 4px 4px 0 #e9b47f;
}
a.problem-card.hard {
  box-shadow: 4px 4px 0 #b65a67;
}
a.problem-card:hover {
  transform: translate(1px, 1px);
  box-shadow: 3px 3px 0 #a76f45;
  border-color: var(--pixel-border);
}
a.problem-card.easy:hover {
  box-shadow: 3px 3px 0 #6f9f5f;
}
a.problem-card.medium:hover {
  box-shadow: 3px 3px 0 #c18b58;
}
a.problem-card.hard:hover {
  box-shadow: 3px 3px 0 #8a3f4a;
}
a.problem-card.solved {
  border-color: #777066;
  box-shadow: 4px 4px 0 #a6a09a !important;
  background: linear-gradient(180deg, #f4f1ea 0%, #ebe6dd 100%);
  filter: grayscale(0.55);
}
a.problem-card.solved:hover {
  box-shadow: 3px 3px 0 #8f8983 !important;
}
.card-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 10px;
}
.difficulty {
  display: inline-block;
  padding: 2px 10px 4px;
  font-size: 0.85rem;
  letter-spacing: 0.04em;
  text-transform: uppercase;
  border: 2px solid;
  border-radius: 0;
  background: #fff8e8;
}
.difficulty.easy {
  color: #27ae60;
  border-color: rgba(39, 174, 96, 0.3);
}
.difficulty.medium {
  color: #f39c12;
  border-color: rgba(243, 156, 18, 0.3);
}
.difficulty.hard {
  color: #c0392b;
  border-color: rgba(192, 57, 43, 0.3);
}
.solved-badge {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 2px 8px;
  font-size: 0.75rem;
  font-weight: 600;
  color: #27ae60;
  background: #d4edda;
  border: 2px solid #2a7b4f;
  border-radius: 0;
}
.solved-badge svg {
  width: 12px;
  height: 12px;
}
.problem-card .title {
  margin: 0 0 8px;
  font-size: 1.35rem;
}
.problem-card .meta {
  margin: 0;
  color: var(--muted);
  font-size: 0.95rem;
}
.problem-card .card-fill {
  flex: 1;
  margin-top: 12px;
  min-height: 38px;
  border: 2px solid #d0a46f;
  box-shadow: inset 0 0 0 2px #fff3dc;
  background:
    linear-gradient(90deg, rgba(245, 155, 103, 0.16) 0 8px, transparent 8px 100%),
    repeating-linear-gradient(
      0deg,
      rgba(245, 155, 103, 0.08) 0 2px,
      transparent 2px 12px
    ),
    #fff8e8;
}
.tag-list {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  margin-top: 10px;
}
.tag {
  display: inline-block;
  padding: 2px 8px;
  font-size: 0.75rem;
  color: var(--muted);
  background: #fff8e8;
  border: 1px solid #d9b07a;
  border-radius: 0;
}
.empty {
  margin-top: 32px;
  text-align: center;
  color: var(--muted);
  font-size: 1.1rem;
}
.results-count {
  text-align: center;
  color: var(--muted);
  font-size: 0.95rem;
  margin-bottom: 8px;
}
{% endblock %}

{% block content %}
<header class="page-header">
  <h1>Problems</h1>
  <p class="subtitle">Practice coding challenges</p>
</header>

<form method="get" class="filters">
  <select name="difficulty" onchange="this.form.submit()">
    <option value="">All Difficulties</option>
    {% for value, label in difficulty_choices %}
      <option value="{{ value }}" {% if current_difficulty == value|stringformat:"d" %}selected{% endif %}>{{ label }}</option>
    {% endfor %}
  </select>
  
  {% if available_tags %}
    <select name="tag" onchange="this.form.submit()">
      <option value="">All Topics</option>
      {% for tag in available_tags %}
        <option value="{{ tag.slug }}" {% if current_tag == tag.slug %}selected{% endif %}>{{ tag.name }}</option>
      {% endfor %}
    </select>
  {% endif %}
  
  {% if user.is_authenticated %}
    <select name="status" onchange="this.form.submit()">
      <option value="">All Status</option>
      <option value="solved" {% if current_status == "solved" %}selected{% endif %}>Solved</option>
      <option value="unsolved" {% if current_status == "unsolved" %}selected{% endif %}>Unsolved</option>
    </select>
  {% endif %}
  
  {% if current_difficulty or current_status or current_tag %}
    <a href="{% url 'problems:index' %}" class="filter-clear">Clear Filters</a>
  {% endif %}
</form>

{% if published_problem_list %}
  <p class="results-count">{{ published_problem_list|length }} problem{{ published_problem_list|length|pluralize }}</p>
  
  <ul class="problem-list">
    {% for problem in published_problem_list %}
      <li>
        <a class="problem-card {% if problem.difficulty == 1 %}easy{% elif problem.difficulty == 2 %}medium{% else %}hard{% endif %} {% if problem.id in solved_problem_ids %}solved{% endif %}" href="{% url 'problems:detail' problem.slug %}">
          <div class="card-header">
            <span class="difficulty {% if problem.difficulty == 1 %}easy{% elif problem.difficulty == 2 %}medium{% else %}hard{% endif %}">
              {{ problem.get_difficulty_display }}
            </span>
            {% if problem.id in solved_problem_ids %}
              <span class="solved-badge">
                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>
                Solved
              </span>
            {% endif %}
          </div>
          <h2 class="title">{{ problem.title }}</h2>
          <p class="meta">{{ problem.description|truncatewords:12 }}</p>
          <div class="card-fill" aria-hidden="true"></div>
          {% if problem.tags.all %}
            <div class="tag-list">
              {% for tag in problem.tags.all %}
                <span class="tag">{{ tag.name }}</span>
              {% endfor %}
            </div>
          {% endif %}
        </a>
      </li>
    {% endfor %}
  </ul>
{% else %}
  <p class="empty">
    {% if current_difficulty or current_status or current_tag %}
      No problems match your filters. <a href="{% url 'problems:index' %}">Clear filters</a>
    {% else %}
      No published problems yet. Check back soon.
    {% endif %}
  </p>
{% endif %}
{% endblock %}
